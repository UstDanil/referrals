REFERRALS_API_IMAGE_NAME ?= referrals-api
REFERRALS_DB_NAME ?=  referrals
REFERRALS_DB_USERNAME ?= referrals
REFERRALS_DB_PASSWORD ?= referrals
REFERRALS_DB_PORT ?= 5432
REFERRALS_DB_HOST ?= referrals-db
REFERRALS_NETWORK ?= "referrals"
REFERRALS_REFERRER_CODE_EXPIRE_MINUTES ?= 129600
REFERRALS_REFERRER_CODE_LENGTH ?= 10
REFERRALS_JWT_SECRET ?= 58c16649230kl87rd7c2fa1615fcd744614a3c4ira18w1kv
REFERRALS_JWT_ALGORITHM ?= HS512
REFERRALS_JWT_ACCESS_TOKEN_EXPIRE_MINUTES ?= 43200

.PHONY: build
build:
	docker build -t $(REFERRALS_API_IMAGE_NAME) -f Dockerfile .

.PHONY: run
run:
	- docker network create $(REFERRALS_NETWORK)
	APP_NETWORK=$(REFERRALS_NETWORK) \
	APP_API_IMAGE_NAME=$(REFERRALS_API_IMAGE_NAME) \
    APP_DB_USERNAME=$(REFERRALS_DB_USERNAME) \
    APP_DB_PASSWORD=$(REFERRALS_DB_PASSWORD) \
    APP_DB_NAME=$(REFERRALS_DB_NAME) \
    APP_DB_PORT=$(REFERRALS_DB_PORT) \
    APP_DB_HOST=$(REFERRALS_DB_HOST) \
    APP_API_REFERRER_CODE_EXPIRE_MINUTES=$(REFERRALS_REFERRER_CODE_EXPIRE_MINUTES) \
    APP_API_REFERRER_CODE_LENGTH=$(REFERRALS_REFERRER_CODE_LENGTH) \
    APP_API_JWT_SECRET=$(REFERRALS_JWT_SECRET) \
    APP_API_JWT_ALGORITHM=$(REFERRALS_JWT_ALGORITHM) \
    APP_API_JWT_ACCESS_TOKEN_EXPIRE_MINUTES=$(REFERRALS_JWT_ACCESS_TOKEN_EXPIRE_MINUTES) \
	docker-compose -f docker-compose.yaml up -d
